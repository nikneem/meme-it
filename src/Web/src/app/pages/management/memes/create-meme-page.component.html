<div class="container mx-auto px-4 py-8 max-w-6xl">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Meme</h1>
    <p class="text-gray-600">Upload media, add text areas by clicking on the image, and provide a name to create your meme</p>
  </div>
  
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Media Upload and Preview -->
    <div class="lg:col-span-2">
      <p-card header="Media Upload" styleClass="h-fit">
        @if (!uploadedFile()) {
          <app-file-drop-zone
            [maxSizeBytes]="maxFileSize"
            [acceptedTypes]="acceptedTypes"
            (onFileSelected)="onFileSelected($event)"
            (onValidationError)="onValidationError($event)" />
        } @else {
          <app-media-preview
            [uploadedFile]="uploadedFile()"
            [textAreas]="textAreas()"
            [selectedTextAreaId]="selectedTextAreaId()"
            (onTextAreasChange)="onTextAreasChange($event)"
            (onTextAreaSelect)="onTextAreaSelect($event)" />
          
          <!-- Change media button -->
          <div class="mt-4 flex justify-between">
            <button pButton
                    label="Change Media"
                    icon="pi pi-upload"
                    severity="secondary"
                    (click)="clearMedia()"></button>
            
            @if (textAreas().length > 0) {
              <button pButton
                      label="Clear All Text"
                      icon="pi pi-trash"
                      severity="danger"
                      [outlined]="true"
                      (click)="clearAllText()"></button>
            }
          </div>
        }
      </p-card>
    </div>
    
    <!-- Meme Details Form -->
    <div class="lg:col-span-1">
      <p-card header="Meme Details" styleClass="h-fit">
        <div class="space-y-4">
          <!-- Name -->
          <div>
            <label for="name" class="block text-sm font-medium mb-1">Name *</label>
            <input pInputText
                   id="name"
                   [ngModel]="memeName()"
                   (ngModelChange)="memeName.set($event)"
                   placeholder="Enter meme name"
                   class="w-full"
                   [maxlength]="100" />
          </div>
          
          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-medium mb-1">Description</label>
            <textarea id="description"
                      [ngModel]="memeDescription()"
                      (ngModelChange)="memeDescription.set($event)"
                      placeholder="Optional description"
                      class="w-full p-2 border border-gray-300 rounded"
                      rows="3"
                      [maxlength]="500"></textarea>
          </div>
          
          <!-- Stats -->
          @if (uploadedFile()) {
            <div class="text-sm text-gray-600 space-y-1">
              <div class="flex justify-between">
                <span>Media:</span>
                <span>{{ uploadedFile()!.file.name }}</span>
              </div>
              <div class="flex justify-between">
                <span>Size:</span>
                <span>{{ formatFileSize(uploadedFile()!.file.size) }}</span>
              </div>
              <div class="flex justify-between">
                <span>Dimensions:</span>
                <span>{{ uploadedFile()!.dimensions?.width }}Ã—{{ uploadedFile()!.dimensions?.height }}</span>
              </div>
              <div class="flex justify-between">
                <span>Text Areas:</span>
                <span>{{ textAreas().length }}</span>
              </div>
            </div>
          }
          
          <!-- Requirements Status -->
          @if (uploadedFile() && !canCreateMeme()) {
            <div class="text-sm text-amber-600 bg-amber-50 border border-amber-200 rounded p-3">
              <div class="font-medium mb-2">To create your meme, you need:</div>
              <ul class="space-y-1">
                <li class="flex items-center">
                  <i class="pi mr-2" [class]="memeName().trim().length > 0 ? 'pi-check text-green-600' : 'pi-circle text-gray-400'"></i>
                  A meme name
                </li>
                <li class="flex items-center">
                  <i class="pi mr-2" [class]="uploadedFile() && uploadedFileName() ? 'pi-check text-green-600' : 'pi-circle text-gray-400'"></i>
                  Upload media file
                </li>
                <li class="flex items-center">
                  <i class="pi mr-2" [class]="textAreas().length > 0 ? 'pi-check text-green-600' : 'pi-circle text-gray-400'"></i>
                  Add at least one text area
                </li>
              </ul>
            </div>
          }
          
          <!-- Action Buttons -->
          <div class="space-y-2 pt-4">
            <button pButton
                    label="Create Meme"
                    icon="pi pi-check"
                    class="w-full"
                    [disabled]="!canCreateMeme()"
                    [loading]="isCreating()"
                    (click)="createMeme()"></button>
            
            <button pButton
                    label="Cancel"
                    icon="pi pi-times"
                    severity="secondary"
                    [outlined]="true"
                    class="w-full"
                    [disabled]="isCreating()"
                    (click)="cancel()"></button>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div>

<p-toast position="top-right"></p-toast>
