<div class="media-preview-container" #container [style.width.px]="containerSize().width"
  [style.height.px]="containerSize().height" (click)="onContainerClick($event)">

  <!-- Media display -->
  @if (uploadedFile() && uploadedFile()!.type.startsWith('image/')) {
  <img #mediaElement [src]="uploadedFile()!.url" [alt]="uploadedFile()!.file.name" class="media-element"
    [style.width.px]="containerSize().width" [style.height.px]="containerSize().height" (load)="onMediaLoad()" />
  } @else if (uploadedFile() && uploadedFile()!.type.startsWith('video/')) {
  <video #mediaElement [src]="uploadedFile()!.url" class="media-element" [style.width.px]="containerSize().width"
    [style.height.px]="containerSize().height" controls muted (loadedmetadata)="onMediaLoad()">
    Your browser does not support the video tag.
  </video>
  } @else {
  <div class="placeholder-area" [style.width.px]="containerSize().width" [style.height.px]="containerSize().height">
    <div class="placeholder-content">
      <i class="pi pi-image text-6xl text-gray-400 mb-4"></i>
      <p class="text-gray-500 text-lg">Drop media here to get started</p>
    </div>
  </div>
  }

  <!-- Text areas overlay -->
  @if (uploadedFile()) {
  <div class="text-areas-overlay" [style.width.px]="containerSize().width" [style.height.px]="containerSize().height">
    @for (textArea of textAreas(); track textArea.id) {
    <app-draggable-text-area [textArea]="textArea" [isSelected]="selectedTextAreaId() === textArea.id"
      [containerBounds]="containerBounds()" (onTextAreaChange)="onTextAreaChange($event)"
      (onDelete)="onDeleteTextArea(textArea.id)" (onSelect)="onSelectTextArea(textArea.id)" />
    }
  </div>
  }

  <!-- Add text area button -->
  @if (uploadedFile() && textAreas().length === 0) {
  <div class="add-text-prompt">
    <button class="add-text-button" (click)="addTextArea($event)">
      <i class="pi pi-plus mr-2"></i>
      Click anywhere to add text
    </button>
  </div>
  }
</div>

<!-- Properties panel - positioned relative to container but can extend beyond -->
@if (selectedTextArea()) {
  <div class="properties-panel" 
       [style.left.px]="propertiesPanelPosition().x"
       [style.top.px]="propertiesPanelPosition().y">
    <p-card header="Text Area Properties" 
            styleClass="w-80 shadow-lg">
      
      <div class="space-y-4">
        <!-- Font Family -->
        <div>
          <label class="block text-sm font-medium mb-1">Font Family</label>
          <select [ngModel]="selectedTextArea()!.fontFamily"
                  (ngModelChange)="updateTextAreaProperty('fontFamily', $event)"
                  class="w-full p-2 border border-gray-300 rounded">
            @for (font of fontOptions; track font.value) {
              <option [value]="font.value">{{ font.label }}</option>
            }
          </select>
        </div>
        
        <!-- Font Size -->
        <div>
          <label class="block text-sm font-medium mb-1">Font Size</label>
          <p-inputNumber [ngModel]="selectedTextArea()!.fontSize"
                       (ngModelChange)="updateTextAreaProperty('fontSize', $event)"
                       [min]="8"
                       [max]="72"
                       suffix="px"
                       styleClass="w-full" />
        </div>
        
        <!-- Font Color -->
        <div>
          <label class="block text-sm font-medium mb-1">Font Color</label>
          <p-colorPicker [ngModel]="selectedTextArea()!.fontColor"
                       (ngModelChange)="updateTextAreaProperty('fontColor', $event)"
                       format="hex"
                       styleClass="w-full" />
        </div>

        <!-- Font Bold -->
        <div>
          <label class="block text-sm font-medium mb-1">Bold Font</label>
          <p-toggleswitch [ngModel]="selectedTextArea()!.fontBold"
                        (ngModelChange)="updateTextAreaProperty('fontBold', $event)" />
        </div>

        <!-- Text Border -->
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm font-medium mb-1">Border Thickness</label>
            <p-inputNumber [ngModel]="selectedTextArea()!.borderThickness"
                         (ngModelChange)="updateTextAreaProperty('borderThickness', $event)"
                         [min]="0"
                         [max]="10"
                         suffix="px"
                         styleClass="w-full" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Border Color</label>
            <p-colorPicker [ngModel]="selectedTextArea()!.borderColor"
                         (ngModelChange)="updateTextAreaProperty('borderColor', $event)"
                         format="hex"
                         styleClass="w-full" />
          </div>
        </div>
        
        <!-- Max Length -->
        <div>
          <label class="block text-sm font-medium mb-1">Max Characters</label>
          <p-inputNumber [ngModel]="selectedTextArea()!.maxLength"
                       (ngModelChange)="updateTextAreaProperty('maxLength', $event)"
                       [min]="1"
                       [max]="500"
                       styleClass="w-full" />
        </div>
        
        <!-- Position & Size -->
        <div class="grid grid-cols-2 gap-2">
          <div>
            <label class="block text-sm font-medium mb-1">X</label>
            <p-inputNumber [ngModel]="selectedTextArea()!.x"
                         (ngModelChange)="updateTextAreaProperty('x', $event)"
                         [min]="0"
                         suffix="px"
                         styleClass="w-full" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Y</label>
            <p-inputNumber [ngModel]="selectedTextArea()!.y"
                         (ngModelChange)="updateTextAreaProperty('y', $event)"
                         [min]="0"
                         suffix="px"
                         styleClass="w-full" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Width</label>
            <p-inputNumber [ngModel]="selectedTextArea()!.width"
                         (ngModelChange)="updateTextAreaProperty('width', $event)"
                         [min]="50"
                         suffix="px"
                         styleClass="w-full" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Height</label>
            <p-inputNumber [ngModel]="selectedTextArea()!.height"
                         (ngModelChange)="updateTextAreaProperty('height', $event)"
                         [min]="20"
                         suffix="px"
                         styleClass="w-full" />
          </div>
        </div>
      </div>
    </p-card>
  </div>
}

<!-- Media info -->
@if (uploadedFile()) {
<div class="media-info mt-4 p-3 bg-gray-50 rounded-lg">
  <div class="flex items-center justify-between">
    <div>
      <p class="font-medium">{{ uploadedFile()!.file.name }}</p>
      <p class="text-sm text-gray-600">
        {{ formatFileSize(uploadedFile()!.file.size) }} •
        {{ uploadedFile()!.dimensions?.width }}×{{ uploadedFile()!.dimensions?.height }}
      </p>
    </div>
    <div class="text-sm text-gray-600">
      {{ textAreas().length }} text area{{ textAreas().length !== 1 ? 's' : '' }}
    </div>
  </div>
</div>
}